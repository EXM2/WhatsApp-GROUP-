<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>قروبات واتساب - دليل شامل ذكي</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
/* نفس التنسيق السابق + إضافات */
body { font-family:'Tajawal',sans-serif; margin:0; padding:0; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#333; }
.container { max-width:1200px; margin:0 auto; padding:20px; }
h1 { text-align:center; color:white; margin-bottom:20px; text-shadow:2px 2px 4px rgba(0,0,0,0.3); }

.counter-box { text-align:center; color:white; margin-bottom:15px; font-size:1.2rem; }

form { background:white; padding:20px; border-radius:15px; margin-bottom:30px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
form input, form button, form select { padding:12px; border-radius:10px; border:1px solid #ccc; font-size:1rem; flex:1; }
form button { background:linear-gradient(135deg,#25d366 0%,#128c7e 100%); color:white; border:none; cursor:pointer; transition:0.3s; }
form button:hover { transform:translateY(-2px); box-shadow:0 4px 10px rgba(37,211,102,0.3); }

.search-box { flex:1; position:relative; }
.search-box input { width:100%; padding:12px 40px 12px 12px; border-radius:10px; border:1px solid #ccc; }
.search-box i { position:absolute; right:10px; top:50%; transform:translateY(-50%); color:#999; }

.filters { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; }
.filter-btn { padding:10px 20px; border-radius:25px; border:2px solid #e0e0e0; background:#f0f0f0; cursor:pointer; transition:0.3s; }
.filter-btn.active { background:linear-gradient(135deg,#25d366 0%,#128c7e 100%); color:white; border-color:#25d366; }

.groups-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:20px; }

.group-card {
  background:white;
  border-radius:15px;
  overflow:hidden;
  box-shadow:0 4px 15px rgba(0,0,0,0.1);
  display:flex;
  flex-direction:column;
  transition:0.3s;
  animation: fadeIn 0.5s ease;
}
.group-card:hover { transform:translateY(-10px); box-shadow:0 15px 30px rgba(0,0,0,0.15); }

@keyframes fadeIn {
  from { opacity:0; transform:translateY(20px); }
  to { opacity:1; transform:translateY(0); }
}

.group-image-container {
  height:180px;
  background:#eee;
  display:flex;
  justify-content:center;
  align-items:center;
  overflow:hidden;
}
.group-image { width:100%; height:100%; object-fit:cover; }

.group-content { padding:15px; flex-grow:1; display:flex; flex-direction:column; }
.group-title { font-size:1.2rem; font-weight:bold; margin-bottom:5px; color:#333; }
.group-description { color:#666; font-size:0.95rem; margin-bottom:10px; line-height:1.4; flex-grow:1; }
.group-meta { font-size:0.85rem; color:#999; margin-bottom:10px; }

.group-actions { display:flex; gap:10px; margin-top:auto; }
.join-btn, .delete-btn, .copy-btn {
  flex:1; padding:10px; border:none; border-radius:10px; font-weight:bold; cursor:pointer;
}
.join-btn { background:linear-gradient(135deg,#25d366 0%,#128c7e 100%); color:white; }
.copy-btn { background:#007bff; color:white; }
.delete-btn { background:linear-gradient(135deg,#ff4d4d 0%,#cc0000 100%); color:white; }

.no-groups { text-align:center; padding:40px 20px; background:white; border-radius:15px; color:#666; grid-column:1/-1; }
.no-groups .icon { font-size:4rem; margin-bottom:10px; opacity:0.2; }
</style>
</head>

<body>
<div class="container">

<h1>قروبات واتساب</h1>

<div class="counter-box">
عدد القروبات: <span id="groupCount">0</span>
</div>

<form id="groupForm">
<input type="text" id="groupName" placeholder="اسم القروب" required>
<input type="text" id="groupLink" placeholder="رابط القروب" required>
<input type="number" id="groupMembers" placeholder="عدد الأعضاء" required>

<select id="groupCategory" required>
  <option value="all">عام</option>
  <option value="games">ألعاب</option>
  <option value="study">دراسة</option>
  <option value="other">أخرى</option>
</select>

<input type="file" id="groupImage" accept="image/*">

<button type="submit">إضافة القروب</button>
</form>

<div class="filters">
<button class="filter-btn active" data-filter="all">الكل</button>
<button class="filter-btn" data-filter="games">ألعاب</button>
<button class="filter-btn" data-filter="study">دراسة</button>
<button class="filter-btn" data-filter="other">أخرى</button>
</div>

<div class="search-box">
<input type="text" id="searchInput" placeholder="ابحث عن القروب...">
<i class="fas fa-search"></i>
</div>

<div class="groups-grid" id="groupsList"></div>

</div>

<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<script>
// ---------------------------
// نظام الهوية + الأدمن
// ---------------------------
if(!localStorage.getItem("userId")){
  localStorage.setItem("userId", "user_" + Date.now());
}
const currentUser = localStorage.getItem("userId");

let isAdmin = localStorage.getItem("isAdmin") === "true";
const ADMIN_PASSWORD = "96638223";

// ---------------------------
// Firebase
// ---------------------------
const firebaseConfig = {
  apiKey: "AIzaSyCEEWOwJJPhRcd7tN00WYpkhMMqG9GKXhw",
  authDomain: "whatsapp-group-7f4ec.firebaseapp.com",
  databaseURL: "https://whatsapp-group-7f4ec-default-rtdb.firebaseio.com",
  projectId: "whatsapp-group-7f4ec",
  storageBucket: "whatsapp-group-7f4ec.firebasestorage.app",
  messagingSenderId: "12281639708",
  appId: "1:12281639708:web:a3d2a1e0d02a7f647240d9",
  measurementId: "G-XD7BR6P1ZB"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

const groupForm = document.getElementById('groupForm');
const groupsList = document.getElementById('groupsList');
const searchInput = document.getElementById('searchInput');
const filterBtns = document.querySelectorAll('.filter-btn');

// ---------------------------
// إضافة قروب
// ---------------------------
groupForm.addEventListener('submit', function(e){
  e.preventDefault();

  const name = document.getElementById('groupName').value;
  const link = document.getElementById('groupLink').value;
  const members = document.getElementById('groupMembers').value;
  const category = document.getElementById('groupCategory').value;
  const imageFile = document.getElementById('groupImage').files[0];

  const newGroupRef = database.ref('groups').push();

  if(imageFile){
    const reader = new FileReader();
    reader.onload = function(){
      newGroupRef.set({
        name, link, members, category,
        image: reader.result,
        ownerId: currentUser,
        createdAt: Date.now()
      }).then(() => groupForm.reset());
    };
    reader.readAsDataURL(imageFile);
  } else {
    newGroupRef.set({
      name, link, members, category,
      image: null,
      ownerId: currentUser,
      createdAt: Date.now()
    }).then(() => groupForm.reset());
  }
});

// ---------------------------
// عرض القروبات
// ---------------------------
database.ref('groups').on('value', function(snapshot){
  renderGroups(snapshot.val());
});

function renderGroups(groups){
  groupsList.innerHTML = '';
  let count = 0;

  if(groups){
    const sorted = Object.entries(groups).sort((a,b)=> b[1].createdAt - a[1].createdAt);

    sorted.forEach(([key, g]) => {
      count++;

      const div = document.createElement('div');
      div.className = 'group-card';
      div.setAttribute('data-category', g.category);

      div.innerHTML = `
        <div class="group-image-container">
          ${g.image ? `<img src="${g.image}" class="group-image">` : `<i class="fas fa-users"></i>`}
        </div>
        <div class="group-content">
          <div class="group-title">${g.name}</div>
          <div class="group-description">${g.category}</div>
          <div class="group-meta">عدد الأعضاء: ${g.members}</div>

          <div class="group-actions">
            <a href="${g.link}" target="_blank" class="join-btn">انضم الآن</a>
            <button class="copy-btn" onclick="copyLink('${g.link}')">نسخ الرابط</button>
            <button class="delete-btn" onclick="attemptDelete('${key}', '${g.ownerId}')">حذف</button>
          </div>
        </div>
      `;
      groupsList.appendChild(div);
    });

    document.getElementById('groupCount').textContent = count;

  } else {
    groupsList.innerHTML = '<div class="no-groups"><i class="fas fa-users icon"></i><h3>لا توجد قروبات حالياً</h3></div>';
  }
}

// ---------------------------
// محاولة الحذف (ملكية + أدمن)
// ---------------------------
function attemptDelete(groupId, ownerId){

  if(ownerId === currentUser){
    deleteGroup(groupId);
    return;
  }

  if(isAdmin){
    deleteGroup(groupId);
    return;
  }

  const pass = prompt("أدخل كلمة سر الأدمن لحذف هذا القروب:");

  if(pass === ADMIN_PASSWORD){
    isAdmin = true;
    localStorage.setItem("isAdmin", "true");
    alert("تم تفعيل وضع الأدمن");
    deleteGroup(groupId);
  } else {
    alert("كلمة السر غير صحيحة");
  }
}

// ---------------------------
// حذف القروب
// ---------------------------
function deleteGroup(id){
  database.ref('groups/'+id).remove();
}

// ---------------------------
// نسخ الرابط
// ---------------------------
function copyLink(link){
  navigator.clipboard.writeText(link);
  alert("تم نسخ رابط القروب");
}

// ---------------------------
// البحث
// ---------------------------
searchInput.addEventListener('input', function(){
  const term = searchInput.value.toLowerCase();
  localStorage.setItem('lastSearch', term);

  document.querySelectorAll('.group-card').forEach(card => {
    const title = card.querySelector('.group-title').textContent.toLowerCase();
    card.style.display = title.includes(term) ? 'flex' : 'none';
  });
});

// ---------------------------
// الفلترة
// ---------------------------
filterBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    filterBtns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');

    const cat = btn.getAttribute('data-filter');
    localStorage.setItem('lastFilter', cat);

    document.querySelectorAll('.group-card').forEach(card => {
      const c = card.getAttribute('data-category');
      card.style.display = (cat==='all' || c===cat) ? 'flex' : 'none';
    });
  });
});

// ---------------------------
// استعادة آخر بحث وفلتر
// ---------------------------
window.onload = () => {
  const lastSearch = localStorage.getItem('lastSearch');
  const lastFilter = localStorage.getItem('lastFilter');

  if(lastSearch){
    searchInput.value = lastSearch;
    searchInput.dispatchEvent(new Event('input'));
  }

  if(lastFilter){
    document.querySelector(`[data-filter="${lastFilter}"]`)?.click();
  }
};
</script>

</body>
</html>