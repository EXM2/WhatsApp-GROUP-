<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>قروبات تلجرام - دليل شامل ذكي</title>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://pl28557264.effectivegatecpm.com/66/c7/7d/66c77d7ac95f5328a050e5b7c4929460.js"></script>

<style>
:root {
  --primary: #27A7E7;        /* أزرق تلجرام */
  --primary-dark: #1E8FC7;   /* أزرق داكن */
  --secondary: #667eea;      /* يمكن تعديله لاحقاً */
  --danger: #ff4757;
  --warning: #ffa502;
  --dark: #1a1a2e;
  --darker: #16213e;
  --light: #f8f9fa;
  --card-bg: #ffffff;
  --text: #333333;
  --text-muted: #6c757d;
  --shadow: 0 10px 40px rgba(0,0,0,0.1);
  --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="dark"] {
  --card-bg: #1e1e2e;
  --light: #0f0f1a;
  --text: #e0e0e0;
  --text-muted: #a0a0a0;
  --shadow: 0 10px 40px rgba(0,0,0,0.3);
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Tajawal', sans-serif;
  background: var(--light);
  color: var(--text);
  min-height: 100vh;
  transition: var(--transition);
}

/* Loading Overlay */
.loading-overlay {
  position: fixed;
  inset: 0;
  background: var(--light);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  transition: opacity 0.5s ease;
}

.loading-overlay.hidden {
  opacity: 0;
  pointer-events: none;
}

.loading-spinner {
  width: 60px;
  height: 60px;
  border: 4px solid rgba(39, 167, 231, 0.2);
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

.loading-text {
  margin-top: 20px;
  font-size: 1.2rem;
  color: var(--text-muted);
}

/* Header */
.header {
  background: linear-gradient(135deg, #27A7E7 0%, #1E8FC7 50%, #0E6B9E 100%);
  padding: 30px 20px;
  text-align: center;
  position: relative;
  overflow: hidden;
}

.header::before {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
  animation: pulse 15s infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

.header h1 {
  color: white;
  font-size: 2.5rem;
  font-weight: 800;
  text-shadow: 2px 2px 10px rgba(0,0,0,0.2);
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 15px;
}

.header h1 i {
  font-size: 2rem;
  animation: bounce 2s infinite;
}

@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.stats-bar {
  display: flex;
  justify-content: center;
  gap: 30px;
  margin-top: 20px;
  flex-wrap: wrap;
}

.stat-item {
  background: rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
  padding: 15px 30px;
  border-radius: 50px;
  color: white;
  display: flex;
  align-items: center;
  gap: 10px;
}

.stat-item i { font-size: 1.5rem; }
.stat-number { font-size: 1.5rem; font-weight: 700; }

/* Navigation Links - يمكن إضافة رابط للعودة للواتساب */
.nav-links {
  margin-top: 20px;
  display: flex;
  justify-content: center;
  gap: 15px;
}

.nav-link {
  background: rgba(255,255,255,0.2);
  backdrop-filter: blur(10px);
  padding: 12px 25px;
  border-radius: 50px;
  color: white;
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 10px;
  transition: var(--transition);
  font-weight: 500;
}

.nav-link:hover {
  background: rgba(255,255,255,0.3);
  transform: translateY(-2px);
}

.nav-link i {
  font-size: 1.3rem;
}

/* Connection Status */
.connection-status {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  padding: 10px 20px;
  border-radius: 50px;
  font-size: 0.85rem;
  font-weight: 600;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: var(--shadow);
}

.connection-status.online {
  background: var(--primary);
  color: white;
}

.connection-status.offline {
  background: var(--danger);
  color: white;
}

.connection-status .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: currentColor;
  animation: blink 1.5s infinite;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.3; }
}

/* Theme Toggle */
.theme-toggle {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  background: var(--card-bg);
  border: none;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  cursor: pointer;
  box-shadow: var(--shadow);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3rem;
  color: var(--text);
  transition: var(--transition);
}

.theme-toggle:hover { transform: rotate(180deg); }

/* Container */
.container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 30px 20px;
}

/* Add Form */
.add-form-container {
  background: var(--card-bg);
  border-radius: 20px;
  padding: 30px;
  margin-bottom: 30px;
  box-shadow: var(--shadow);
}

.form-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  cursor: pointer;
}

.form-header h2 {
  display: flex;
  align-items: center;
  gap: 10px;
  color: var(--primary-dark);
}

.form-header .toggle-icon {
  transition: var(--transition);
  color: var(--text);
}

.form-header.collapsed .toggle-icon {
  transform: rotate(180deg);
}

.add-form {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  max-height: 1000px;
  opacity: 1;
  overflow: hidden;
  transition: max-height 0.5s ease, opacity 0.3s ease, padding 0.3s ease;
}

.add-form.hidden {
  max-height: 0;
  opacity: 0;
  padding: 0;
  margin: 0;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-group label {
  font-weight: 600;
  color: var(--text-muted);
  font-size: 0.9rem;
}

.form-group input,
.form-group select {
  padding: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 12px;
  font-size: 1rem;
  font-family: inherit;
  background: var(--card-bg);
  color: var(--text);
  transition: var(--transition);
}

[data-theme="dark"] .form-group input,
[data-theme="dark"] .form-group select {
  border-color: #3a3a4a;
}

.form-group input:focus,
.form-group select:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 4px rgba(39, 167, 231, 0.1);
}

.form-group input.error {
  border-color: var(--danger);
  animation: shake 0.5s;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-5px); }
  75% { transform: translateX(5px); }
}

.image-upload {
  border: 2px dashed #ccc;
  border-radius: 12px;
  padding: 30px;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  position: relative;
}

[data-theme="dark"] .image-upload {
  border-color: #3a3a4a;
}

.image-upload:hover {
  border-color: var(--primary);
  background: rgba(39, 167, 231, 0.05);
}

.image-upload input {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

.image-upload i { font-size: 2rem; color: var(--text-muted); }
.image-upload p { margin-top: 10px; color: var(--text-muted); }

.image-preview {
  width: 100px;
  height: 100px;
  object-fit: cover;
  border-radius: 10px;
  margin-top: 10px;
}

.submit-btn {
  grid-column: 1 / -1;
  padding: 18px;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  font-family: inherit;
}

.submit-btn:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 30px rgba(39, 167, 231, 0.3);
}

.submit-btn:disabled {
  opacity: 0.7;
  cursor: not-allowed;
  transform: none;
}

.submit-btn .spinner {
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Search & Filter */
.search-filter-bar {
  display: flex;
  gap: 15px;
  margin-bottom: 30px;
  flex-wrap: wrap;
}

.search-box {
  flex: 1;
  min-width: 300px;
  position: relative;
}

.search-box input {
  width: 100%;
  padding: 18px 50px 18px 20px;
  border: none;
  border-radius: 15px;
  font-size: 1rem;
  background: var(--card-bg);
  box-shadow: var(--shadow);
  color: var(--text);
  transition: var(--transition);
  font-family: inherit;
}

.search-box input:focus {
  outline: none;
  box-shadow: var(--shadow), 0 0 0 3px rgba(39, 167, 231, 0.2);
}

.search-box i {
  position: absolute;
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
  color: var(--text-muted);
}

.sort-select {
  padding: 18px 25px;
  border: none;
  border-radius: 15px;
  font-size: 1rem;
  background: var(--card-bg);
  box-shadow: var(--shadow);
  color: var(--text);
  cursor: pointer;
  font-family: inherit;
}

.filters {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 30px;
}

.filter-btn {
  padding: 12px 25px;
  border-radius: 50px;
  border: 2px solid transparent;
  background: var(--card-bg);
  color: var(--text);
  cursor: pointer;
  font-weight: 600;
  transition: var(--transition);
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.05);
  font-family: inherit;
}

.filter-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.1);
}

.filter-btn.active {
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
}

.filter-btn .count {
  background: rgba(255,255,255,0.2);
  padding: 2px 8px;
  border-radius: 20px;
  font-size: 0.8rem;
}

/* Groups Grid */
.groups-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 25px;
}

.group-card {
  background: var(--card-bg);
  border-radius: 20px;
  overflow: hidden;
  box-shadow: var(--shadow);
  transition: var(--transition);
  animation: fadeInUp 0.5s ease forwards;
  opacity: 0;
  position: relative;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.group-card:hover {
  transform: translateY(-10px) scale(1.02);
  box-shadow: 0 20px 50px rgba(0,0,0,0.15);
}

@media (prefers-reduced-motion: reduce) {
  .group-card:hover {
    transform: translateY(-5px);
  }
  .header::before {
    animation: none;
  }
  .header h1 i {
    animation: none;
  }
}

.group-image-container {
  height: 200px;
  background: linear-gradient(135deg, var(--secondary) 0%, var(--primary-dark) 100%);
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  overflow: hidden;
}

.group-image-container::before {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.5) 100%);
}

.group-image {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: var(--transition);
}

.group-card:hover .group-image {
  transform: scale(1.1);
}

.group-image-placeholder {
  font-size: 4rem;
  color: rgba(255,255,255,0.5);
}

.category-badge {
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(255,255,255,0.9);
  padding: 8px 15px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--primary-dark);
  display: flex;
  align-items: center;
  gap: 5px;
}

.favorite-btn {
  position: absolute;
  top: 15px;
  left: 15px;
  background: rgba(255,255,255,0.9);
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition);
  color: var(--text-muted);
}

.favorite-btn:hover { transform: scale(1.1); }
.favorite-btn.active { background: var(--danger); color: white; }
.favorite-btn.active i { animation: heartbeat 0.5s; }

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.3); }
}

.group-content {
  padding: 20px;
}

.group-title {
  font-size: 1.3rem;
  font-weight: 700;
  margin-bottom: 10px;
  color: var(--text);
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.group-meta {
  display: flex;
  gap: 15px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 0.9rem;
  color: var(--text-muted);
}

.meta-item i { color: var(--primary); }

.group-actions {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.action-btn {
  padding: 12px;
  border: none;
  border-radius: 12px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  font-size: 0.95rem;
  font-family: inherit;
  text-decoration: none;
}

.action-btn:hover { transform: translateY(-2px); }

.join-btn {
  grid-column: 1 / -1;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
}

.join-btn:hover { box-shadow: 0 8px 25px rgba(39, 167, 231, 0.3); }

.copy-btn {
  background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
  color: white;
}

.share-btn {
  background: linear-gradient(135deg, #6f42c1 0%, #4a148c 100%);
  color: white;
}

.delete-btn {
  grid-column: 1 / -1;
  background: linear-gradient(135deg, var(--danger) 0%, #c0392b 100%);
  color: white;
}

/* No Groups */
.no-groups {
  grid-column: 1 / -1;
  text-align: center;
  padding: 60px 20px;
  background: var(--card-bg);
  border-radius: 20px;
  box-shadow: var(--shadow);
}

.no-groups i {
  font-size: 5rem;
  color: var(--text-muted);
  opacity: 0.3;
  margin-bottom: 20px;
}

.no-groups h3 {
  font-size: 1.5rem;
  color: var(--text);
  margin-bottom: 10px;
}

.no-groups p { color: var(--text-muted); }

/* Toast Notification */
.toast-container {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.toast {
  background: var(--card-bg);
  padding: 15px 25px;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  display: flex;
  align-items: center;
  gap: 12px;
  animation: slideUp 0.3s ease;
  min-width: 300px;
  color: var(--text);
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.toast.success { border-right: 4px solid var(--primary); }
.toast.error { border-right: 4px solid var(--danger); }
.toast.warning { border-right: 4px solid var(--warning); }

.toast i { font-size: 1.3rem; }
.toast.success i { color: var(--primary); }
.toast.error i { color: var(--danger); }
.toast.warning i { color: var(--warning); }

/* Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition);
  padding: 20px;
}

.modal-overlay.active {
  opacity: 1;
  visibility: visible;
}

.modal {
  background: var(--card-bg);
  border-radius: 20px;
  padding: 30px;
  max-width: 400px;
  width: 100%;
  transform: scale(0.9);
  transition: var(--transition);
  text-align: center;
}

.modal-overlay.active .modal {
  transform: scale(1);
}

.modal h3 {
  margin-bottom: 15px;
  color: var(--text);
  font-size: 1.5rem;
}

.modal h3 i {
  color: var(--warning);
  margin-left: 10px;
}

.modal p {
  color: var(--text-muted);
  margin-bottom: 20px;
  font-size: 1rem;
}

.modal-input {
  width: 100%;
  padding: 15px;
  border: 2px solid #e0e0e0;
  border-radius: 10px;
  margin-bottom: 20px;
  font-size: 1rem;
  text-align: center;
  font-family: inherit;
  background: var(--card-bg);
  color: var(--text);
}

[data-theme="dark"] .modal-input {
  border-color: #3a3a4a;
}

.modal-input:focus {
  outline: none;
  border-color: var(--primary);
}

.modal-actions {
  display: flex;
  gap: 10px;
}

.modal-actions button {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 10px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  font-family: inherit;
  font-size: 1rem;
}

.modal-actions .confirm-btn {
  background: var(--danger);
  color: white;
}

.modal-actions .cancel-btn {
  background: #e0e0e0;
  color: var(--text);
}

[data-theme="dark"] .modal-actions .cancel-btn {
  background: #3a3a4a;
}

.modal-actions button:hover {
  transform: translateY(-2px);
}

/* Scroll to top */
.scroll-top {
  position: fixed;
  bottom: 30px;
  right: 30px;
  width: 50px;
  height: 50px;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  opacity: 0;
  visibility: hidden;
  transition: var(--transition);
  box-shadow: 0 5px 20px rgba(39, 167, 231, 0.3);
}

.scroll-top.visible {
  opacity: 1;
  visibility: visible;
}

.scroll-top:hover {
  transform: translateY(-5px);
}

/* Ad Interstitial Overlay */
.ad-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99998;
  opacity: 0;
  visibility: hidden;
  transition: all 0.3s ease;
}

.ad-overlay.active {
  opacity: 1;
  visibility: visible;
}

.ad-container {
  background: var(--card-bg);
  border-radius: 20px;
  padding: 30px;
  max-width: 500px;
  width: 90%;
  text-align: center;
  position: relative;
  transform: scale(0.8);
  transition: all 0.3s ease;
}

.ad-overlay.active .ad-container {
  transform: scale(1);
}

.ad-header {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
  color: var(--primary);
  font-size: 1.2rem;
  font-weight: 700;
}

.ad-header i {
  animation: spin 2s linear infinite;
}

.ad-content {
  min-height: 250px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 20px;
  background: var(--light);
  border-radius: 12px;
  overflow: hidden;
}

.ad-countdown-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

.ad-countdown-circle {
  width: 70px;
  height: 70px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.8rem;
  font-weight: 800;
  color: white;
  box-shadow: 0 5px 20px rgba(39, 167, 231, 0.3);
  transition: all 0.3s ease;
}

.ad-countdown-text {
  color: var(--text-muted);
  font-size: 0.95rem;
}

.ad-progress-bar {
  width: 100%;
  height: 6px;
  background: #e0e0e0;
  border-radius: 3px;
  margin-top: 10px;
  overflow: hidden;
}

[data-theme="dark"] .ad-progress-bar {
  background: #3a3a4a;
}

.ad-progress-fill {
  height: 100%;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  border-radius: 3px;
  transition: width 1s linear;
  width: 0%;
}

.ad-skip-btn {
  padding: 15px 40px;
  background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 700;
  cursor: pointer;
  font-family: inherit;
  transition: all 0.3s ease;
  display: none;
  align-items: center;
  justify-content: center;
  gap: 8px;
  margin-top: 15px;
  animation: fadeInUp 0.3s ease;
}

.ad-skip-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(39, 167, 231, 0.3);
}

@media (max-width: 480px) {
  .ad-container {
    padding: 20px;
    width: 95%;
  }
  .ad-content {
    min-height: 200px;
  }
}

/* Responsive */
@media (max-width: 768px) {
  .header h1 {
    font-size: 1.8rem;
  }
  .header h1 i {
    font-size: 1.5rem;
  }
  .stats-bar {
    gap: 15px;
  }
  .stat-item {
    padding: 10px 20px;
    font-size: 0.9rem;
  }
  .stat-number {
    font-size: 1.2rem;
  }
  .search-box {
    min-width: 100%;
  }
  .sort-select {
    width: 100%;
  }
  .groups-grid {
    grid-template-columns: 1fr;
  }
  .add-form {
    grid-template-columns: 1fr;
  }
  .container {
    padding: 20px 15px;
  }
  .filters {
    overflow-x: auto;
    flex-wrap: nowrap;
    padding-bottom: 10px;
    -webkit-overflow-scrolling: touch;
  }
  .filter-btn {
    flex-shrink: 0;
    padding: 10px 18px;
    font-size: 0.9rem;
  }
  .theme-toggle {
    width: 40px;
    height: 40px;
    font-size: 1rem;
    top: 15px;
    left: 15px;
  }
  .connection-status {
    top: 15px;
    right: 15px;
    padding: 8px 15px;
    font-size: 0.8rem;
  }
  .group-card:hover {
    transform: translateY(-5px);
  }
  .modal {
    padding: 20px;
    margin: 10px;
  }
}

@media (max-width: 480px) {
  .header {
    padding: 20px 15px;
  }
  .header h1 {
    font-size: 1.5rem;
  }
  .stat-item {
    padding: 8px 15px;
    font-size: 0.85rem;
  }
  .add-form-container {
    padding: 20px;
  }
  .form-group input,
  .form-group select {
    padding: 12px;
  }
  .submit-btn {
    padding: 15px;
    font-size: 1rem;
  }
  .group-image-container {
    height: 160px;
  }
  .group-content {
    padding: 15px;
  }
  .group-title {
    font-size: 1.1rem;
  }
  .action-btn {
    padding: 10px;
    font-size: 0.85rem;
  }
  .scroll-top {
    width: 45px;
    height: 45px;
    bottom: 20px;
    right: 20px;
  }
}
</style>
</head>

<body>
<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
  <p class="loading-text">جاري تحميل البيانات...</p>
</div>

<!-- Connection Status -->
<div class="connection-status online" id="connectionStatus">
  <span class="dot"></span>
  <span id="connectionText">متصل</span>
</div>

<!-- Theme Toggle -->
<button class="theme-toggle" onclick="toggleTheme()" aria-label="تبديل الوضع">
  <i class="fas fa-moon"></i>
</button>

<!-- Scroll to Top -->
<button class="scroll-top" id="scrollTop" onclick="scrollToTop()" aria-label="الصعود للأعلى">
  <i class="fas fa-arrow-up"></i>
</button>

<!-- Header -->
<header class="header">
  <h1>
    <i class="fab fa-telegram"></i>
    قروبات تلجرام
  </h1>
  <div class="stats-bar">
    <div class="stat-item">
      <i class="fas fa-users"></i>
      <span>عدد القروبات:</span>
      <span class="stat-number" id="groupCount">0</span>
    </div>
    <div class="stat-item">
      <i class="fas fa-heart"></i>
      <span>المفضلة:</span>
      <span class="stat-number" id="favCount">0</span>
    </div>
  </div>
  <!-- زر العودة إلى قروبات واتساب (اختياري) -->
  <div class="nav-links">
    <a href="index.html" class="nav-link whatsapp">
      <i class="fab fa-whatsapp"></i>
      <span>قروبات واتساب</span>
    </a>
  </div>
</header>

<div class="container">
  <!-- Add Form -->
  <div class="add-form-container">
    <div class="form-header collapsed" onclick="toggleForm()">
      <h2>
        <i class="fas fa-plus-circle"></i>
        إضافة قروب تلجرام جديد
      </h2>
      <i class="fas fa-chevron-up toggle-icon"></i>
    </div>

    <form class="add-form hidden" id="groupForm">
      <div class="form-group">
        <label><i class="fas fa-signature"></i> اسم القروب</label>
        <input type="text" id="groupName" placeholder="أدخل اسم القروب" required>
      </div>

      <div class="form-group">
        <label><i class="fas fa-link"></i> رابط القروب</label>
        <input type="url" id="groupLink" placeholder="https://t.me/..." required>
      </div>

      <div class="form-group">
        <label><i class="fas fa-users"></i> عدد الأعضاء</label>
        <input type="number" id="groupMembers" placeholder="عدد الأعضاء" min="1" required>
      </div>

      <div class="form-group">
        <label><i class="fas fa-folder"></i> التصنيف</label>
        <select id="groupCategory" required>
          <option value="">اختر التصنيف</option>
          <option value="general">عام</option>
          <option value="games">ألعاب</option>
          <option value="study">دراسة</option>
          <option value="tech">تقنية</option>
          <option value="sports">رياضة</option>
          <option value="news">أخبار</option>
          <option value="entertainment">ترفيه</option>
          <option value="business">أعمال</option>
          <option value="other">أخرى</option>
        </select>
      </div>

      <div class="form-group" style="grid-column: 1 / -1;">
        <label><i class="fas fa-image"></i> صورة القروب (اختياري - الحد الأقصى 500KB)</label>
        <div class="image-upload" id="imageUpload">
          <input type="file" id="groupImage" accept="image/jpeg,image/png,image/gif,image/webp" onchange="previewImage(this)">
          <i class="fas fa-cloud-upload-alt"></i>
          <p>اضغط أو اسحب الصورة هنا</p>
          <img id="imagePreview" class="image-preview" style="display: none;">
        </div>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        <i class="fas fa-plus"></i>
        إضافة القروب
      </button>
    </form>
  </div>

  <!-- Search & Filter -->
  <div class="search-filter-bar">
    <div class="search-box">
      <input type="text" id="searchInput" placeholder="ابحث عن قروب..." oninput="applyFilters()">
      <i class="fas fa-search"></i>
    </div>
    <select class="sort-select" id="sortSelect" onchange="applyFilters()">
      <option value="newest">الأحدث أولاً</option>
      <option value="oldest">الأقدم أولاً</option>
      <option value="members-high">الأكثر أعضاء</option>
      <option value="members-low">الأقل أعضاء</option>
      <option value="name">أبجدياً</option>
    </select>
  </div>

  <div class="filters" id="filtersContainer">
    <button class="filter-btn active" data-filter="all" onclick="setFilter('all')">
      <i class="fas fa-globe"></i> الكل
      <span class="count" id="count-all">0</span>
    </button>
    <button class="filter-btn" data-filter="favorites" onclick="setFilter('favorites')">
      <i class="fas fa-heart"></i> المفضلة
      <span class="count" id="count-favorites">0</span>
    </button>
    <button class="filter-btn" data-filter="general" onclick="setFilter('general')">
      <i class="fas fa-comments"></i> عام
    </button>
    <button class="filter-btn" data-filter="games" onclick="setFilter('games')">
      <i class="fas fa-gamepad"></i> ألعاب
    </button>
    <button class="filter-btn" data-filter="study" onclick="setFilter('study')">
      <i class="fas fa-graduation-cap"></i> دراسة
    </button>
    <button class="filter-btn" data-filter="tech" onclick="setFilter('tech')">
      <i class="fas fa-laptop-code"></i> تقنية
    </button>
    <button class="filter-btn" data-filter="sports" onclick="setFilter('sports')">
      <i class="fas fa-futbol"></i> رياضة
    </button>
    <button class="filter-btn" data-filter="entertainment" onclick="setFilter('entertainment')">
      <i class="fas fa-film"></i> ترفيه
    </button>
  </div>

  <!-- Groups Grid -->
  <div class="groups-grid" id="groupsList"></div>
</div>

<!-- Ad Interstitial Overlay -->
<div class="ad-overlay" id="adOverlay">
  <div class="ad-container">
    <div class="ad-header">
      <i class="fas fa-spinner"></i>
      <span>جاري تجهيز رابط القروب...</span>
    </div>
    <div class="ad-content" id="adContent">
      <!-- Adsterra ad loads here -->
    </div>
    <div class="ad-countdown-container">
      <div class="ad-countdown-circle" id="adCountdown">7</div>
      <p class="ad-countdown-text" id="adCountdownText">سيتم نقلك للقروب بعد <strong id="adSeconds">7</strong> ثواني</p>
      <div class="ad-progress-bar">
        <div class="ad-progress-fill" id="adProgressFill"></div>
      </div>
    </div>
    <button class="ad-skip-btn" id="adSkipBtn">
      <i class="fab fa-telegram"></i>
      انضم الآن
    </button>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Delete Modal -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal">
    <h3><i class="fas fa-lock"></i> كلمة المرور مطلوبة</h3>
    <p>أدخل كلمة المرور للحذف</p>
    <input type="password" class="modal-input" id="passwordInput" placeholder="أدخل كلمة المرور">
    <div class="modal-actions">
      <button class="confirm-btn" onclick="confirmDelete()">
        <i class="fas fa-trash"></i> حذف
      </button>
      <button class="cancel-btn" onclick="closeDeleteModal()">
        <i class="fas fa-times"></i> إلغاء
      </button>
    </div>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-app.js";
import { getDatabase, ref, push, get, remove, update, onValue, off } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-database.js";

// ============ إعداد Firebase (نفس الإعدادات) ============
const firebaseConfig = {
  apiKey: "AIzaSyCEEWOwJJPhRcd7tN00WYpkhMMqG9GKXhw",
  authDomain: "whatsapp-group-7f4ec.firebaseapp.com",
  databaseURL: "https://whatsapp-group-7f4ec-default-rtdb.firebaseio.com",
  projectId: "whatsapp-group-7f4ec",
  storageBucket: "whatsapp-group-7f4ec.appspot.com",
  messagingSenderId: "12281639708",
  appId: "1:12281639708:web:a3d2a1e0d02a7f647240d9"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
// استخدام مسار منفصل لقروبات تلجرام
const telegramGroupsRef = ref(db, 'telegram-groups');

// ============ المتغيرات العامة ============
let groups = {};
let currentFilter = 'all';
let deleteTargetKey = null;
const DELETE_PASSWORD = '123456';

// ============ التصنيفات ============
const categories = {
  general: { name: 'عام', icon: 'fas fa-comments' },
  games: { name: 'ألعاب', icon: 'fas fa-gamepad' },
  study: { name: 'دراسة', icon: 'fas fa-graduation-cap' },
  tech: { name: 'تقنية', icon: 'fas fa-laptop-code' },
  sports: { name: 'رياضة', icon: 'fas fa-futbol' },
  news: { name: 'أخبار', icon: 'fas fa-newspaper' },
  entertainment: { name: 'ترفيه', icon: 'fas fa-film' },
  business: { name: 'أعمال', icon: 'fas fa-briefcase' },
  other: { name: 'أخرى', icon: 'fas fa-folder' }
};

// ============ تهيئة الصفحة ============
loadTheme();
setupScrollListener();
setupConnectionMonitor();

// ============ الاستماع للتغييرات في Firebase (Real-time) ============
onValue(telegramGroupsRef, (snapshot) => {
  groups = snapshot.val() || {};
  renderGroups();
  updateStats();
  hideLoading();
}, (error) => {
  console.error('Firebase Error:', error);
  showToast('حدث خطأ في الاتصال بقاعدة البيانات', 'error');
  hideLoading();
});

// ============ مراقبة حالة الاتصال ============
function setupConnectionMonitor() {
  const connectedRef = ref(db, '.info/connected');
  onValue(connectedRef, (snap) => {
    const statusEl = document.getElementById('connectionStatus');
    const textEl = document.getElementById('connectionText');

    if (snap.val() === true) {
      statusEl.className = 'connection-status online';
      textEl.textContent = 'متصل';
    } else {
      statusEl.className = 'connection-status offline';
      textEl.textContent = 'غير متصل';
    }
  });
}

// ============ إخفاء شاشة التحميل ============
function hideLoading() {
  setTimeout(() => {
    document.getElementById('loadingOverlay').classList.add('hidden');
  }, 500);
}

// ============ الوضع الداكن ============
window.toggleTheme = function() {
  const body = document.body;
  const btn = document.querySelector('.theme-toggle i');

  if (body.getAttribute('data-theme') === 'dark') {
    body.removeAttribute('data-theme');
    btn.className = 'fas fa-moon';
    localStorage.setItem('theme', 'light');
  } else {
    body.setAttribute('data-theme', 'dark');
    btn.className = 'fas fa-sun';
    localStorage.setItem('theme', 'dark');
  }
}

function loadTheme() {
  const theme = localStorage.getItem('theme');
  const btn = document.querySelector('.theme-toggle i');

  if (theme === 'dark') {
    document.body.setAttribute('data-theme', 'dark');
    btn.className = 'fas fa-sun';
  }
}

// ============ نموذج الإضافة ============
window.toggleForm = function() {
  const form = document.getElementById('groupForm');
  const header = document.querySelector('.form-header');

  form.classList.toggle('hidden');
  header.classList.toggle('collapsed');
}

// ============ معاينة الصورة مع التحقق ============
window.previewImage = function(input) {
  const file = input.files[0];
  const preview = document.getElementById('imagePreview');
  const uploadArea = document.getElementById('imageUpload');

  if (file) {
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
    if (!allowedTypes.includes(file.type)) {
      showToast('نوع الملف غير مدعوم. الرجاء اختيار صورة بصيغة JPG, PNG, GIF أو WebP', 'error');
      input.value = '';
      return;
    }

    // حد 500KB للـ Firebase (لأن Base64 يزيد الحجم)
    const maxSize = 500 * 1024;
    if (file.size > maxSize) {
      showToast('حجم الصورة كبير جداً. الحد الأقصى 500KB', 'error');
      input.value = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = (e) => {
      preview.src = e.target.result;
      preview.style.display = 'block';
      uploadArea.querySelector('i').style.display = 'none';
      uploadArea.querySelector('p').style.display = 'none';
    };
    reader.readAsDataURL(file);
  }
}

// ============ إضافة قروب تلجرام جديد ============
document.getElementById('groupForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const name = document.getElementById('groupName').value.trim();
  const link = document.getElementById('groupLink').value.trim();
  const members = parseInt(document.getElementById('groupMembers').value);
  const category = document.getElementById('groupCategory').value;
  const imageInput = document.getElementById('groupImage');

  // التحقق من الرابط (يجب أن يكون رابط تلجرام صحيح)
  if (!link.includes('t.me') && !link.includes('telegram.me') && !link.includes('telegram.dog')) {
    showToast('الرجاء إدخال رابط تلجرام صحيح (يحتوي على t.me)', 'error');
    document.getElementById('groupLink').classList.add('error');
    setTimeout(() => {
      document.getElementById('groupLink').classList.remove('error');
    }, 1000);
    return;
  }

  // التحقق من تكرار الرابط
  const existingLinks = Object.values(groups).map(g => g.link);
  if (existingLinks.includes(link)) {
    showToast('هذا القروب موجود بالفعل!', 'warning');
    return;
  }

  const submitBtn = document.getElementById('submitBtn');
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<div class="spinner"></div> جاري الإضافة...';

  try {
    let imageData = '';
    if (imageInput.files[0]) {
      imageData = await readFileAsDataURL(imageInput.files[0]);
    }

    const newGroup = {
      name,
      link,
      members,
      category,
      image: imageData,
      favorite: false,
      createdAt: new Date().toISOString()
    };

    await push(telegramGroupsRef, newGroup);

    // إعادة تعيين النموذج
    document.getElementById('groupForm').reset();
    document.getElementById('imagePreview').style.display = 'none';
    document.getElementById('imageUpload').querySelector('i').style.display = 'block';
    document.getElementById('imageUpload').querySelector('p').style.display = 'block';

    toggleForm();
    showToast('تم إضافة القروب بنجاح!', 'success');

  } catch (error) {
    console.error('Error adding group:', error);
    showToast('حدث خطأ أثناء إضافة القروب', 'error');
  }

  submitBtn.disabled = false;
  submitBtn.innerHTML = '<i class="fas fa-plus"></i> إضافة القروب';
});

// ============ قراءة الملف كـ Base64 ============
function readFileAsDataURL(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

// ============ عرض القروبات ============
function renderGroups() {
  const container = document.getElementById('groupsList');
  let filteredGroups = getFilteredGroups();

  if (filteredGroups.length === 0) {
    container.innerHTML = `
      <div class="no-groups">
        <i class="fab fa-telegram"></i>
        <h3>لا توجد قروبات</h3>
        <p>${currentFilter === 'favorites' ? 'لم تقم بإضافة أي قروب للمفضلة بعد' : 'قم بإضافة أول قروب تلجرام الآن!'}</p>
      </div>
    `;
    return;
  }

  container.innerHTML = filteredGroups.map(([key, group], index) => `
    <div class="group-card" style="animation-delay: ${index * 0.1}s">
      <div class="group-image-container">
        ${group.image
          ? `<img src="${group.image}" class="group-image" alt="${escapeHtml(group.name)}" loading="lazy">`
          : '<i class="fab fa-telegram group-image-placeholder"></i>'
        }
        <span class="category-badge">
          <i class="${categories[group.category]?.icon || 'fas fa-folder'}"></i>
          ${categories[group.category]?.name || 'أخرى'}
        </span>
        <button class="favorite-btn ${group.favorite ? 'active' : ''}"
                onclick="toggleFavorite('${key}')"
                aria-label="إضافة للمفضلة">
          <i class="fas fa-heart"></i>
        </button>
      </div>
      <div class="group-content">
        <h3 class="group-title">${escapeHtml(group.name)}</h3>
        <div class="group-meta">
          <span class="meta-item">
            <i class="fas fa-users"></i>
            ${group.members.toLocaleString('ar-EG')} عضو
          </span>
          <span class="meta-item">
            <i class="fas fa-clock"></i>
            ${formatDate(group.createdAt)}
          </span>
        </div>
        <div class="group-actions">
          <a href="${group.link}" target="_blank" class="action-btn join-btn">
            <i class="fab fa-telegram"></i>
            انضمام
          </a>
          <button class="action-btn copy-btn" onclick="copyLink('${group.link}')">
            <i class="fas fa-copy"></i>
            نسخ
          </button>
          <button class="action-btn share-btn" onclick="shareGroup('${escapeHtml(group.name)}', '${group.link}')">
            <i class="fas fa-share-alt"></i>
            مشاركة
          </button>
          <button class="action-btn delete-btn" onclick="openDeleteModal('${key}')">
            <i class="fas fa-trash"></i>
            حذف
          </button>
        </div>
      </div>
    </div>
  `).join('');
}

// ============ الفلاتر والترتيب ============
function getFilteredGroups() {
  let entries = Object.entries(groups);

  // فلتر التصنيف
  if (currentFilter === 'favorites') {
    entries = entries.filter(([key, g]) => g.favorite === true);
  } else if (currentFilter !== 'all') {
    entries = entries.filter(([key, g]) => g.category === currentFilter);
  }

  // فلتر البحث
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
  if (searchTerm) {
    entries = entries.filter(([key, g]) =>
      g.name.toLowerCase().includes(searchTerm) ||
      (categories[g.category]?.name || '').includes(searchTerm)
    );
  }

  // الترتيب
  const sortBy = document.getElementById('sortSelect').value;
  switch (sortBy) {
    case 'oldest':
      entries.sort((a, b) => new Date(a[1].createdAt) - new Date(b[1].createdAt));
      break;
    case 'members-high':
      entries.sort((a, b) => b[1].members - a[1].members);
      break;
    case 'members-low':
      entries.sort((a, b) => a[1].members - b[1].members);
      break;
    case 'name':
      entries.sort((a, b) => a[1].name.localeCompare(b[1].name, 'ar'));
      break;
    default: // newest
      entries.sort((a, b) => new Date(b[1].createdAt) - new Date(a[1].createdAt));
  }

  return entries;
}

window.setFilter = function(filter) {
  currentFilter = filter;

  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.filter === filter);
  });

  renderGroups();
}

window.applyFilters = function() {
  renderGroups();
}

// ============ المفضلة ============
window.toggleFavorite = async function(key) {
  try {
    const group = groups[key];
    const newFavoriteState = !group.favorite;

    await update(ref(db, `telegram-groups/${key}`), {
      favorite: newFavoriteState
    });

    if (newFavoriteState) {
      showToast('تم إضافة القروب للمفضلة', 'success');
    } else {
      showToast('تم إزالة القروب من المفضلة', 'warning');
    }
  } catch (error) {
    console.error('Error toggling favorite:', error);
    showToast('حدث خطأ', 'error');
  }
}

// ============ الحذف ============
window.openDeleteModal = function(key) {
  deleteTargetKey = key;
  document.getElementById('deleteModal').classList.add('active');
  document.getElementById('passwordInput').value = '';
  document.getElementById('passwordInput').focus();
}

window.closeDeleteModal = function() {
  deleteTargetKey = null;
  document.getElementById('deleteModal').classList.remove('active');
}

window.confirmDelete = async function() {
  const password = document.getElementById('passwordInput').value;

  if (password !== DELETE_PASSWORD) {
    showToast('كلمة المرور غير صحيحة!', 'error');
    return;
  }

  try {
    await remove(ref(db, `telegram-groups/${deleteTargetKey}`));
    closeDeleteModal();
    showToast('تم حذف القروب بنجاح', 'success');
  } catch (error) {
    console.error('Error deleting group:', error);
    showToast('حدث خطأ أثناء الحذف', 'error');
  }
}

// ============ النسخ والمشاركة ============
window.copyLink = function(link) {
  navigator.clipboard.writeText(link).then(() => {
    showToast('تم نسخ الرابط!', 'success');
  }).catch(() => {
    const textarea = document.createElement('textarea');
    textarea.value = link;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    showToast('تم نسخ الرابط!', 'success');
  });
}

window.shareGroup = function(name, link) {
  const shareText = `انضم لقروب "${name}" على تلجرام:\n${link}`;

  if (navigator.share) {
    navigator.share({
      title: name,
      text: shareText,
      url: link
    }).catch(() => {});
  } else {
    copyLink(link);
    showToast('تم نسخ الرابط للمشاركة!', 'success');
  }
}

// ============ الإشعارات (Toast) ============
function showToast(message, type = 'success') {
  const container = document.getElementById('toastContainer');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;

  const icons = {
    success: 'fas fa-check-circle',
    error: 'fas fa-exclamation-circle',
    warning: 'fas fa-exclamation-triangle'
  };

  toast.innerHTML = `
    <i class="${icons[type] || icons.success}"></i>
    <span>${message}</span>
  `;

  container.appendChild(toast);

  setTimeout(() => {
    toast.style.opacity = '0';
    toast.style.transform = 'translateY(20px)';
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

// جعل showToast متاحة عالمياً
window.showToast = showToast;

// ============ الإحصائيات ============
function updateStats() {
  const groupsArray = Object.values(groups);
  const totalGroups = groupsArray.length;
  const totalFavs = groupsArray.filter(g => g.favorite).length;

  document.getElementById('groupCount').textContent = totalGroups.toLocaleString('ar-EG');
  document.getElementById('favCount').textContent = totalFavs.toLocaleString('ar-EG');
  document.getElementById('count-all').textContent = totalGroups;
  document.getElementById('count-favorites').textContent = totalFavs;
}

// ============ أدوات مساعدة ============
function formatDate(dateString) {
  if (!dateString) return 'غير معروف';

  const date = new Date(dateString);
  const now = new Date();
  const diff = now - date;
  const days = Math.floor(diff / (1000 * 60 * 60 * 24));

  if (days === 0) return 'اليوم';
  if (days === 1) return 'أمس';
  if (days < 7) return `منذ ${days} أيام`;
  if (days < 30) return `منذ ${Math.floor(days / 7)} أسابيع`;

  return date.toLocaleDateString('ar-EG');
}

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

// ============ زر الصعود للأعلى ============
function setupScrollListener() {
  const scrollBtn = document.getElementById('scrollTop');

  window.addEventListener('scroll', () => {
    if (window.scrollY > 300) {
      scrollBtn.classList.add('visible');
    } else {
      scrollBtn.classList.remove('visible');
    }
  });
}

window.scrollToTop = function() {
  window.scrollTo({
    top: 0,
    behavior: 'smooth'
  });
}

// ============ إغلاق المودال ============
document.getElementById('deleteModal').addEventListener('click', (e) => {
  if (e.target.id === 'deleteModal') {
    closeDeleteModal();
  }
});

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeDeleteModal();
    // أيضاً إغلاق الإعلان إذا انتهى العد
    const skipBtn = document.getElementById('adSkipBtn');
    if (skipBtn && skipBtn.style.display === 'inline-flex') {
      document.getElementById('adOverlay').classList.remove('active');
    }
  }
  if (e.key === 'Enter' && document.getElementById('deleteModal').classList.contains('active')) {
    confirmDelete();
  }
});

// ============ إعلان Adsterra قبل الانضمام ============
let adTargetLink = null;
let adCountdownInterval = null;

// اعتراض نقرات زر الانضمام
document.addEventListener('click', function(e) {
  const joinBtn = e.target.closest('.join-btn');
  if (joinBtn) {
    e.preventDefault();
    e.stopPropagation();
    adTargetLink = joinBtn.getAttribute('href');
    showAdOverlay();
  }
});

function showAdOverlay() {
  const overlay = document.getElementById('adOverlay');
  const countdownEl = document.getElementById('adCountdown');
  const secondsEl = document.getElementById('adSeconds');
  const skipBtn = document.getElementById('adSkipBtn');
  const countdownText = document.getElementById('adCountdownText');
  const progressFill = document.getElementById('adProgressFill');

  overlay.classList.add('active');
  skipBtn.style.display = 'none';
  countdownText.style.display = 'block';
  progressFill.style.width = '0%';

  let seconds = 7;
  countdownEl.textContent = seconds;
  secondsEl.textContent = seconds;

  if (adCountdownInterval) clearInterval(adCountdownInterval);

  // بدء شريط التقدم
  setTimeout(() => {
    progressFill.style.width = '100%';
    progressFill.style.transition = 'width 7s linear';
  }, 50);

  adCountdownInterval = setInterval(() => {
    seconds--;
    countdownEl.textContent = seconds;
    secondsEl.textContent = seconds;

    if (seconds <= 0) {
      clearInterval(adCountdownInterval);
      adCountdownInterval = null;
      countdownText.style.display = 'none';
      skipBtn.style.display = 'inline-flex';
    }
  }, 1000);
}

// زر الانضمام بعد انتهاء العد
document.getElementById('adSkipBtn').addEventListener('click', function() {
  document.getElementById('adOverlay').classList.remove('active');
  const progressFill = document.getElementById('adProgressFill');
  progressFill.style.transition = 'none';
  progressFill.style.width = '0%';
  if (adTargetLink) {
    window.open(adTargetLink, '_blank');
  }
});

// إغلاق عند النقر خارج المحتوى (فقط بعد انتهاء العد)
document.getElementById('adOverlay').addEventListener('click', function(e) {
  if (e.target === this) {
    const skipBtn = document.getElementById('adSkipBtn');
    if (skipBtn.style.display === 'inline-flex') {
      this.classList.remove('active');
      const progressFill = document.getElementById('adProgressFill');
      progressFill.style.transition = 'none';
      progressFill.style.width = '0%';
    }
  }
});
</script>

</body>
</html>